<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Student Login</title>  
    <script type="module">  
        // Your SDK import statements  
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";  
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";  

        const firebaseConfig = {  
            // Your configuration here  
        };  

        const app = initializeApp(firebaseConfig);  
        const db = getFirestore(app);  

        window.validateRegnumber = function() {  
            const regnumberInput = document.getElementById("regnumber");  
            const regnumber = regnumberInput.value;  

            if (regnumber.length < 8 || regnumber.length > 9) {  
                regnumberInput.classList.add("invalid");  
            } else {  
                regnumberInput.classList.remove("invalid");  
            }  
        };  

        window.validateStudentLogIn = async function(event) {  
            event.preventDefault(); // Prevent the default form submission  

            const regnumberInput = document.getElementById("regnumber");  
            const regnumber = regnumberInput.value;  
            const passwordInput = document.getElementById("password");  
            const password = passwordInput.value;  

            // Validate empty inputs  
            if (regnumber === '' || password === '') {  
                alert("Fill in Empty Spaces");  
                return false;  
            }  

            // Validate regnumber length  
            if (regnumber.length < 8 || regnumber.length > 9) {  
                regnumberInput.classList.add("invalid");  
                alert("Invalid Registration Number! It should be 8 or 9 characters.");  
                return false;  
            }  

            // Query Firestore to validate credentials  
            const studentsRef = collection(db, 'students');  
            const q = query(studentsRef, where('regNumber', '==', regnumber), where('password', '==', password));  

            const querySnapshot = await getDocs(q);  
            if (!querySnapshot.empty) {  
                // Valid credentials  
                alert("Login successful!");  
                // Redirect to another page  
                window.location.href = "homepage.html";   
            } else {  
                // Invalid credentials  
                alert("Invalid Registration Number or Password!");  
            }  
            return false; // Return false to indicate the form should not submit  
        };  
    </script>  
</head>  
<body>  
    <form id="StudentLogin" onsubmit="return validateStudentLogIn(event);">  
        <label for="regnumber">Registration Number</label>  
        <input type="text" id="regnumber" name="regnumber" placeholder="Registration Number" required oninput="validateRegnumber()">  
        
        <label for="password">Password</label>  
        <input type="password" id="password" name="password" placeholder="Password" required>  

        <button type="submit" class="btn-login">Log In</button>  
    </form>  
</body>  
</html>
